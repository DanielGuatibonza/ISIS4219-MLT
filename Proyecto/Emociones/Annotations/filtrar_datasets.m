%% Inicio
clear; clc;
load('./Annotations.mat');
%% Filtrar train
train_size = size(train);
contador = 1;
train_filtrado = struct('ruta_archivo', '', 'x1', '', 'y1', '', 'x2', '', 'y2', '', ...
                        'valencia', '', 'excitacion', '', 'dominancia', '');
for i = 1:train_size(2)
    num_personas = size(train(i).person);
    if num_personas(2) == 1
        train_filtrado(contador) = struct('ruta_archivo', strcat(train(i).folder,'/',train(i).filename), ...
                                          'x1', train(i).person.body_bbox(1), ...
                                          'y1', train(i).person.body_bbox(2), ...
                                          'x2', train(i).person.body_bbox(3), ...
                                          'y2', train(i).person.body_bbox(4), ...
                                          'valencia', train(i).person.annotations_continuous.valence, ...
                                          'excitacion', train(i).person.annotations_continuous.arousal, ...
                                          'dominancia', train(i).person.annotations_continuous.dominance);
        contador = contador + 1;
    end
end
%% Filtrar val
val_size = size(val);
contador = 1;
val_filtrado = struct('ruta_archivo', '', 'x1', '', 'y1', '', 'x2', '', 'y2', '', ...
                        'valencia', '', 'excitacion', '', 'dominancia', '');
for i = 1:val_size(2)
    num_personas = size(val(i).person);
    if num_personas(2) == 1
        val_filtrado(contador) = struct('ruta_archivo', strcat(val(i).folder,'/',val(i).filename), ...
                                        'x1', val(i).person.body_bbox(1), ...
                                        'y1', val(i).person.body_bbox(2), ...
                                        'x2', val(i).person.body_bbox(3), ...
                                        'y2', val(i).person.body_bbox(4), ...
                                        'valencia', val(i).person.combined_continuous.valence, ...
                                        'excitacion', val(i).person.combined_continuous.arousal, ...
                                        'dominancia', val(i).person.combined_continuous.dominance);
        contador = contador + 1;
    end
end
%% Filtrar test
test_size = size(test);
contador = 1;
test_filtrado = struct('ruta_archivo', '', 'x1', '', 'y1', '', 'x2', '', 'y2', '', ...
                        'valencia', '', 'excitacion', '', 'dominancia', '');
for i = 1:test_size(2)
    num_personas = size(test(i).person);
    if num_personas(2) == 1
        test_filtrado(contador) = struct('ruta_archivo', strcat(test(i).folder,'/',test(i).filename), ...
                                         'x1', test(i).person.body_bbox(1), ...
                                         'y1', test(i).person.body_bbox(2), ...
                                         'x2', test(i).person.body_bbox(3), ...
                                         'y2', test(i).person.body_bbox(4), ...
                                         'valencia', test(i).person.combined_continuous.valence, ...
                                         'excitacion', test(i).person.combined_continuous.arousal, ...
                                         'dominancia', test(i).person.combined_continuous.dominance);
        contador = contador + 1;
    end
end
%% Escritura de csvs
writetable(struct2table(train_filtrado), '../train.csv');
writetable(struct2table(test_filtrado), '../test.csv');
writetable(struct2table(val_filtrado), '../val.csv');